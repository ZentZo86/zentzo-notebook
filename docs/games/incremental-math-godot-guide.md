---
layout: ../../../layouts/NoteLayout.astro
title: "增量游戏（Incremental Games）数值开发与 Godot 实现指南"
description: "核心数学公式、大数处理库集成以及 Godot 4 最佳实践"
date: 2026-01-31
tags: ["游戏开发", "Godot", "数学", "Incremental Games"]
---

# 增量游戏（Incremental Games）数值开发与 Godot 实现指南

增量游戏的核心在于“数值的艺术”。本文总结了开发此类游戏最关键的数学框架与 Godot 4 的技术实现细节。

---

## 1. 核心数学模型

### 1.1 基础成本公式（指数增长）
这是最经典的公式，用于确保随着玩家拥有量增加，成本迅速上升。

$$Cost = BaseCost \times (Multiplier^{Amount})$$

*   **BaseCost**: 初始购买价格。
*   **Multiplier**: 增长倍率。
    *   *AdVenture Capitalist*: 1.07 - 1.15
    *   *Cookie Clicker*: 1.15
*   **Amount**: 当前已拥有的数量。

**批量购买公式（买 N 个需要多少钱）：**
$$Cost_{total} = BaseCost \times \frac{Multiplier^{Amount} \times (Multiplier^N - 1)}{Multiplier - 1}$$

### 1.2 生产力公式
通常是线性或分层加成。

$$Production = \sum (BaseRate \times Amount) \times \prod (Multipliers) \times PrestigeBonus$$

---

## 2. Prestige（声望/转生）数学

声望系统通过重置进度换取永久性加成，公式设计必须保证玩家每次转生都有明显的“变强”感。

### 2.1 声望货币获取公式
通常基于历史总收益的立方根或平方根。

$$Currency = \text{Multiplier} \times \sqrt{\frac{\text{TotalEarnings}}{\text{Scale}}}$$

*   **特点**：收益递减。为了获得双倍的声望货币，玩家需要赚取 4 倍或 8 倍的总资源。这强迫玩家不得不进行转生。

---

## 3. Godot 4 技术实现：处理大数

Godot 原生的 `int` (64-bit) 最大只能到 $9 \times 10^{18}$，`float` 最大到 $1.8 \times 10^{308}$。增量游戏很快就会突破这个限制。

### 3.1 库推荐：break-nihility
这是目前 Godot 4 处理大数（天文数字）最快的方案，它是 `break_infinity.js` 的 C++ 移植版。

*   **安装**：从 Godot Asset Library 搜索并安装 `break-nihility`。
*   **核心类**：`Big`

### 3.2 代码示例：基础设置

```gdscript
# 定义一个大数变量
var money: Big = Big.new(10) # 初始 10 元

# 增加钱
money = money.plus(Big.new(5))

# 指数增长成本计算
func get_cost(base_cost: float, multiplier: float, amount: int) -> Big:
	var m = Big.new(multiplier)
	return Big.new(base_cost).times(m.pow(amount))

# 格式化输出 (科学计数法 vs 字母表示法)
func _process(_delta):
	# 输出类似 "1.50e15" 或 "1.50 Quadrillion"
	$Label.text = money.to_scientific(2) 
```

### 3.3 数值平滑显示
不要直接跳数字，使用插值让数字看起来在“飞速增长”。

```gdscript
var visual_money: float = 0.0

func _process(delta):
    # 注意：如果数值超过 float 限制，这种平滑方式失效，需要使用 Big 类的插值逻辑
    visual_money = lerp(visual_money, float(money.to_float()), delta * 5)
```

---

## 4. 经验谈：避坑指南

1.  **离线收益的陷阱**：
    *   离线时间计算不要直接放 `_ready`，防止玩家通过修改系统时间作弊。
    *   推荐在服务器校验时间，或者使用 `Time.get_unix_time_from_system()`。
2.  **UI 性能**：
    *   不要在每一帧 (`_process`) 都更新所有的 Label。只有当数值变化达到一定阈值（比如 1%）或者每 0.1 秒更新一次。
3.  **浮点数精度风险**：
    *   当数字非常大时，`1.0e20 + 1` 会因为精度问题依然等于 `1.0e20`。这是使用 `Big` 类库的根本原因。

---

## 5. 参考资源

*   [The Math of Idle Games (Kongregate Blog)](https://blog.kongregate.com/the-math-of-idle-games-part-i/)
*   [Godot Asset: break-nihility](https://godotengine.org/asset-library/asset/4359)
*   [Incremental Game Design Wiki](https://www.reddit.com/r/incremental_games/wiki/design_guide)

---
*Generated by 面包 (Bread) for Boss. 2026-01-31*
